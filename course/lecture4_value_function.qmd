---
subtitle: "第四讲 最大值函数"
editor: visual
---

## 案例导入：新能源车企的产能规划

```{r}
#| echo: false
#| fig-align: center
#| out-height: "50%"
library(ggplot2)
library(showtext)
showtext::showtext_auto()  # 自动加载字体

sysfonts::font_add("Hei", "/System/Library/Fonts/STHeiti Light.ttc")  # 添加系统黑体

df <- 
    data.frame(`电池成本` = seq(800, 1200, 50),
                 `最大利润` = 10000 - 0.5 * (seq(800, 1200, 50) - 1000)^2)

ggplot(df, aes(x = `电池成本`, y = `最大利润`)) +
    geom_line(color = "#E69F00", linewidth = 1.5) +
    geom_vline(xintercept = 1000, linetype = "dashed") +
    labs(title = "电池价格波动对最大利润的影响", subtitle = "某新能源车企生产优化模拟") +
    theme_minimal()
```

**决策困境**：

-   当电池成本θ从1000元/kWh上涨时：

-   单日最大利润下降速度如何量化？

-   是否应调整生产计划或库存策略？

## 本讲学习目标 {.fragment .shout}

1.  **理解**最大值函数的数学构造与经济内涵\
2.  **掌握**包络定理的内容\
3.  **应用**定理解析短期/长期决策差异\
4.  **构建**消费者与生产者行为的统一分析框架

## 最大值函数

-   对于一个最优化问题，一般而言存在着选择变量、目标函数和约束条件。当选择变量达到**最优选择**$\bar{x}$
    时，目标函数取得最大值/最小值，即$v = F(\bar{x})$

-   在给定外生参数$\theta$，以及目标函数和约束条件形式的情况下，每个最优化问题对应着一个最大值$v$
    ，以及一个（或若干个）最优选择$\bar{x}$

-   一旦考虑外生参数$\theta$
    的变化，选择变量所能达到的最优选择将会随之变化。即每种情况下的最优选择$\bar{x}$
    会是外生参数$\theta$ 的函数

-   对应的最大值/最小值实际上也会是外生参数$\theta$ 的函数$v(\theta)$

## 参数进入目标函数的情况

假定参数向量$\theta$ 进入目标函数，通过选择$x$ ，在向量约束$G(x) = c$
下(注意：此时参数$\theta$
并不会影响约束条件)最大化目标函数$F(x, \theta)$

此时，目标函数和拉格朗日函数均依赖于$\theta$，因此

$$L(x, \lambda, \theta) = F(x, \theta) + \lambda[c - G(x)]$$

最优选择$\bar{x}$ 满足一阶条件

$$L_{x}(\bar{x}, \lambda, \theta) = 0 , L_{\lambda} (\bar{x},\lambda, \theta) =0$$

## 最大值的变化

目标函数的最大值记作$v$，假定$\theta$ 变动到$\theta + d\theta$
。这会导致最优选择$\bar{x}$ 变到$\bar{x} + d\bar{x}$，进而最大值$v$
变到$d + dv$：

$$
\begin{aligned}
    dv
    & = F(\bar{x} + d\bar{x}, \theta + d\theta) - F(\bar{x}, \theta) \\
    & = F_{x}(\bar{x}, \theta) d\bar{x} + F_{\theta}(\bar{x}, \theta) d\theta \\
    & = \lambda G_{x}(\bar{x})d\bar{x} + F_{\theta}(\bar{x}, \theta) d\theta \\
    & = F_{\theta}(\bar{x}, \theta) d\theta
\end{aligned}
$$

\footnotesize

-   $G_{x}(\bar{x})d\bar{x} = 0$，因为$G(\bar{x}) = G(\bar{x} + d\bar{x})$

-   当一个**不影响约束条件的参数**发生变化后，如果要计算其所导致目标函数最大值的一阶变化，不需要考虑最优选择$\bar{x}$自身的变动

-   我们可以考虑**在原来的最优选择处**计算参数$\theta$变动的偏导数，以及$\theta$
    的变动情况

## 成本最小化问题 {.allowframebreaks}

最大化$F(x, \theta) = -\theta x$，同时满足$G(x) = c$
。将由此产生的最大值记作$-v$ ，那么

$$
d(-v) = F_{\theta}(\bar{x}, \theta) d\theta = - d\theta \cdot \bar{x}\Longrightarrow dv = \bar{x}d\theta
$$

$v$ 意味着当投入要素价格为$\theta$ 时，生产出$c$ 单位产品的最小成本

当价格发生变化时，生产者会如何调整最优选择？

生产者会减少使用变得更贵的投入要素，同时用更多的（相对更便宜的）其他要素来替代，并且相互替代会沿着一条等产量线进行

<!-- ## 成本最小化问题 II -->

我们对$v = \theta \bar{x}$
进行微分，可得$dv = \theta d\bar{x} + d\theta\bar{x}$

-   第一项意味着，以原来的价格衡量的投入组合变动的价值

-   第二项意味着，以原来的最优产量衡量的价格变动的价值

-   在原来的价格下，原来的投入组合选择已经是最优的了，因此任何变动的价值的一阶效应必然为零

## 包络定理

**包络定理 (Envelope Theorem) 的标准定义：**

在优化问题中，若参数变化时最优值的响应可通过直接效应完全刻画，则间接效应（通过调整决策变量）为零。数学表述为：

设优化问题：

$$
V(a) = \max_{x} \ f(x, a)
$$

其中$x$是决策变量，$a$ 是参数。若 $x^*(a)$ 是内点解且可微，则： $$
\frac{dV(a)}{da} = \frac{\partial f(x^*, a)}{\partial a} \bigg|_{x=x^*(a)}
$$
即参数变化对最优值的影响仅需计算其对目标函数的直接偏导数，无需考虑$x(a)$的调整路径。

## 参数影响所有函数

假定参数$\theta$
同时影响目标函数F和约束条件G，且约束条件为$G(x, \theta) = c$，其中$\theta$
和$c$ 是不同的，因此
$$G_x(x, \theta) dx + G_{\theta} (x, \theta) d\theta = 0$$

对于最大值函数的变动而言

$$
\begin{aligned}
    dv & = -\lambda G_{\theta}(\bar{x}, \theta) d\theta + F_{\theta}(\bar{x}, \theta) d\theta \\
    & = L_{\theta}(\bar{x}, \lambda, \theta) d\theta
\end{aligned}
$$

比较条件5.1和5.4:

-   当$\theta$ 影响约束时，变动$d\theta$
    会影响约束条件$G(x)$，使得G的值增加$G_{\theta}(\bar{x}, \theta)d\theta$

-   这相当于$c$ 减少同等量，等价于$v$
    的值下降$\lambda G_{\theta}(\bar{x}, \theta) d\theta$
    （注意:$\lambda$ 代表着$c$ 变化一单位导致最大值函数$v$ 的边际变化）

## 广义的参数向量 {.allowframebreaks}

\footnotesize

定义一个更大的参数向量$\hat{\theta}$，其包括子向量$\theta$
和$c$，并将约束条件写作：

$$
\hat{G} (x, \hat{\theta}) \equiv G(x, \theta) - c = 0
$$

拉格朗日函数可以写作：

$$
\hat{L}(x, \lambda, \hat{\theta}) \equiv F(x, \theta) - \lambda\hat{G}(x, \hat{\theta})
$$

因此，最大值函数的变动等价于：

$$
dv = \hat{L}_{\hat{\theta}}(\bar{x}, \lambda, \hat{\theta})d\hat{\theta}
$$

而对于广义约束条件而言：

$$
\hat{G}{\hat{\theta}}(x, \hat{\theta}) d\hat{\theta} = G_{\theta}(x, \theta) d\theta - dc
$$

因而$dv$ 的表达式可以变为：

$$
dv = L_{\theta} (\bar{x}, \lambda, \theta) d\theta + \lambda dc.
$$

## 某些选择变量固定不变

- 当外生参数$\theta$发生变化时，会影响最优选择向量$x$的取值，进而影响最大值$v$。

- 包络定理告诉我们，关于最大值$v$的变化$dv$，我们可以不需要了解最优选择$x$的变化。

$$
dv = L_{\theta} (\bar{x}, \lambda, \theta) d\theta + \lambda dc.
$$

- 上式中，$dv$的变化可以区分为两个部分：

  1. 当$x$固定在原来的最优选择下，$\theta$变化对最大值的偏导数效应；
  
  2. 如果参数变动还影响约束条件，还要考虑等价的约束条件右边$c$的影响。



## 短期和长期的生产计划 {.allowframebreaks}

\footnotesize

对于一个厂商而言，长期内资本和劳动都可以调整，但在短期内资本固定在某个水平无法变动。假设选择变量是$y, z$
，其中：

-   在长期中，$y$和$z$ 都可以任意变动

-   在短期内，$z$ 固定不变而仅有$y$ 可以变化

最优化问题可以写作： 

$$
\begin{aligned}
    max  &\quad F(y, z, \theta) \\
    s.t. &\quad G(y,z,\theta) = 0
\end{aligned}
$$

在长期中，最优选择和对应的值函数是外生参数$\theta$ 的函数，即

$$
y_{l} = Y(\theta), z_{l} = Z(\theta), v_{l} = V(\theta)
$$

在短期中，因为$z$固定不变，所以本质上是类似$\theta$ 的参数：

$$y_{s} = Y(z, \theta), v_{s} = V(z, \theta)$$

思考：$v_{l}$ 和$v_{s}$ 之间有什么关系呢？

## 最大值函数的关系

长期最大值和短期最大值之间满足
$$
V(\theta)  \geq V(z, \theta), \forall (z,\theta)
$$

- 对于任意给定的外生参数$\theta$，长期最大值必然大于等于短期最大值；

- 原因在于，短期最大值所能做出的最优选择$y_s = Y(z, \theta)$，一定可以在长期内被选择；

- 等号成立恰好在$y_s = y_l$，即短期内$z$的取值恰好等于长期内$z_l = Z(\theta)$。

如果上述函数都是可微的，那么我们可以得到

$$
V^{'}(\theta)= V_{\theta}(Z(\theta), \theta)
$$

  - 等式右边是短期最优值函数$V(z, \theta)$在变量$z$不变时，在点$z = Z(\theta)$处取值的偏导数。

## 短期和长期成本 {.allowframebreaks}

考虑如下生产函数的短期和长期成本曲线之间的关系： $$
Q = (KL)^{1/\alpha}
$$ 其中，Q代表产量，K是短期固定资本，L是劳动。如果

-   $\alpha = 2$，那么规模报酬不变

-   $\alpha < 2$，那么规模报酬递增

-   $\alpha > 2$，那么规模报酬递减

令$w$表示工资率，$r$表示资本使用成本。则长期成本函数为： 

$$
C(w, r, Q) = \min_{K,L}\{\underbrace{wL + rK}_{\text{最小化成本}} |\underbrace{KL = Q^{\alpha}}_{\text{生产目标}}\}
$$ 使用拉格朗日方法，很容易得到成本最小的投入选择：

$$
\begin{aligned}
    K & = (wQ^{\alpha}/r)^{1/2} \\
    L & = (rQ^{\alpha}/w)^{1/2}
\end{aligned}
$$ 

那么，长期成本函数为：

$$
C(w,r, Q) = 2(wr)^{1/2}Q^{\alpha/2}
$$


在短期内没有选择资本$K$的自由。如果使用资本K生产出产量Q，那么必须使用劳动$L = Q^{\alpha}/K$，成本函数变为：
$$
C(w, r, Q, K)  = wQ^{\alpha}/K + rK
$$

-   长期的边际成本为： $C_{Q}(w,r,Q)= \alpha(wr)^{1/2}Q^{\alpha/2 -1}$

-   短期的边际成本为： $C_{Q}(w,r,Q,K) = \alpha wQ^{\alpha - 1}/K$

-   如果$K$的值恰好是长期中最优值$\bar{K} = (wQ^{\alpha}/r)^{1/2}$，那么短期边际成本和长期边际成本是一样的么？

$$
\begin{aligned}
C_{Q}(w,r,Q,\bar{K})
& = \alpha wQ^{\alpha - 1}/\bar{K} \\
& = \alpha wQ^{\alpha - 1}/(wQ^{\alpha}/r)^{1/2}  \\
& = \alpha(wr)^{1/2}Q^{\alpha/2 -1} \\
\end{aligned}
$$

## 消费者需求 {.allowframebreaks}

考虑一个消费者，在$\textbf{p} \cdot \textbf{x} = I$的预算约束下最大化效用$U(x)$

-   这个最大化问题的参数为价格向量$\textbf{p}$和收入$I$，并由此得到最大效用为$V(\textbf{p}, I)$

-   称$V(\textbf{p}, I)$为**间接效用函数**，以区别于以消费商品数量决定的(直接)效用函数


对于上述效用最大化问题，其拉格朗日函数为： $$
L(x, \lambda, p, I) = U(x) + \lambda(I - px)
$$

回忆一下，包络定理告诉我们，最大值的变动等价于 

$$
dv = \hat{L}_{\hat{\theta}}(\bar{x}, \lambda, \hat{\theta})d\hat{\theta}
$$

因此，在最优解处必然有

$$
\begin{aligned}
    V_I(\textbf{p}, I) & = L_{I}(x, \lambda, p, I) = \lambda \\
    V_{p_i}(\textbf{p}, I) & = L_{p_i}(x, \lambda, p, I) = - \lambda x_i
\end{aligned}
$$

<!-- ## 消费者需求 III -->

-   因此，如果我们知道消费者的间接效用函数，那么可以很轻易地找出消费者的需求函数：
    $$
    D(\textbf{p}, I) = - V_{p}(\textbf{p}, I)/V_I(\textbf{p}, I), \forall i = 1, \cdots, n
    $$

-   相反，如果我们知道消费者的(直接)效用函数，那么需要求解所有约束条件下的最大化问题，才能找到消费者的需求函数

## 支出最小化问题

-   考虑消费者如何以最少的支出达到一个目标效用水平的问题，最小支出是关于价格向量$\textbf{p}$和目标效用水平$u$的函数$E(\textbf{p}, u)$，称之为**支出函数**

-   这个最小化问题的拉格朗日函数可以写作：

$$
    L(x, \mu, p, u) = px + \mu[u - U(x)]
$$

-   类似地，$E_{u}(p, u) = \mu$，意味着为了实现目标效用水平的边际增加，所要求的最小支出的增加

-   以及，$E_{p}(p,u) =x$，代表着对给定效用水平时，使得支出最小的商品组合，我们称之为希克斯需求函数$C(p, u)$

## 斯拉茨基分解

-   从某个效用水平$u$开始，在给定价格水平下达到效用水平所需要的最小支出为$I = E(p,u)$，对应的希克斯需求为$C(p,u)$

-   以上面的最小支出$I$作为货币收入，并找到效用最大化的选择$D(p, I)$，则有$C(p, u) = D(p, I)$

-   对于第$j$个商品的需求，两边同时对第$k$个商品价格求导，根据链式法则有
    
$$
\begin{aligned}
    C^j_k(p, u) & = D^j_k(p, E(p,u)) \\
    & = \underbrace{D^j_k(p, I)}_{\text{替代效应}} + 
    \underbrace{D^j_I(p, I)E_k(p,u)}_{\text{收入效应}}\\
\end{aligned}
$$
